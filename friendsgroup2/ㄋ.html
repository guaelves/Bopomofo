<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>拼音練習</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap">

<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  background: #f0f0f0;
  text-align: center;
  padding: 20px;
}
h1 {
  margin-bottom: 20px;
}

/* 整體容器 */
.wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
}

/* 每一排：左邊泡泡 + 右邊四張卡 */
.row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  width: 100%;
}

/* 泡泡樣式 */
.vowel-bubble {
  background: #fff9c4; /* 淡黃色 */
  color: #333;
  font-weight: bold;
  border-radius: 50%;
  width: 3em;
  height: 3em;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #fbc02d;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  flex-shrink: 0;
}

/* 卡片排列 */
.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 15px;
  flex: 1;
}

.card {
  width: 100%;
  aspect-ratio: 5/7;
  perspective: 800px;
  position: relative;
}
.inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.8s;
  transform-style: preserve-3d;
  cursor: pointer;
}
.card.flipped .inner {
  transform: rotateY(180deg);
}
.front, .back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
}
.front {
  background: #fff;
  border: 2px solid #bbb;
  font-weight: bold;
}
.back {
  background: #fff;
  border: 2px solid #888;
  transform: rotateY(180deg);
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* 成功卡片 */
.back.success {
  background: #d4edda;
  border-color: #28a745;
}

/* 空白卡片 */
.back.empty {
  background: #ffe4e1; /* 淡粉色 */
  border-color: #ffb6c1;
}

/* 失敗 ❌ 樣式 */
.fail {
  color: red;
  font-size: 48px;
}

/* 書本直排注音 */
.zhuyin-part {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.15em;
  line-height: 1;
  font-family: "Noto Sans TC", "PingFang TC", "DFKai-SB", sans-serif;
}
.zhuyin-glyph {
  position: relative;
  font-weight: normal;
  font-size: 2em;
  text-align: center;
}
.zhuyin-tone {
  position: absolute;
  font-size: 1em;
  top: -0.4em;
  right: -0.6em;
}
.zhuyin-dot {
  position: absolute;
  font-size: 0.65em;
  top: 1em;
  left: 50%;
  transform: translateX(-50%);
}

/* 背面直排中文字 */
.word-vertical {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  line-height: 1.15em;
  font-size: calc(4vw + 12px);
}
.word-vertical span {
  display: block;
}
.back-content {
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
  width: 100%;
}
.back-content .zhuyin-part {
  font-size: 0.6em;
}
</style>
</head>
<body>
<h1>ㄋ  拼音練習</h1>

<div class="wrapper" id="wrapper"></div>

<script>
// ---------------- 音訊與語音 ----------------
let audioCtx = null;
let zhTWVoice = null;

function initAudio(){ 
  if(audioCtx) return; 
  try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){console.error("Web Audio not supported");} 
}

function pickPreferredVoice(voices){
  const norm = s => (s||'').toLowerCase().replace(/[\s_\-()（）:：,，.。]+/g,'');
  const isTW = v => /^zh/i.test(v.lang||'') && /tw/i.test(v.lang||'');
  const isG  = v => /google/i.test(v.name||'');
  const isMS = v => /microsoft/i.test(v.name||'');
  const N = voices.map(v => ({ v, name:norm(v.name), uri:norm(v.voiceURI) }));
  let p = N.find(x => isTW(x.v) && isMS(x.v) && (x.name.includes('yating') || x.uri.includes('yating'))); if(p) return p.v;
  p = N.find(x => isTW(x.v) && isMS(x.v) && (x.name.includes('zhiwei') || x.uri.includes('zhiwei'))); if(p) return p.v;
  p = voices.find(v => isTW(v) && isG(v) && /(國語|台灣|臺灣|mandarin|taiwan)/i.test(v.name||'')); if(p) return p;
  return (voices.find(v => !isG(v) && isTW(v)) || voices.find(v =>  isG(v) && isTW(v)) || voices.find(v =>  isG(v) && isCN(v)) || voices.find(v => !isG(v) && isCN(v)) || voices.find(isTW) || voices.find(isCN) || voices.find(isZH) || voices[0] || null);
}

function setupSpeechSynthesis(){
  if(!('speechSynthesis' in window)) return;
  const apply = () => { const voices=speechSynthesis.getVoices()||[]; zhTWVoice=pickPreferredVoice(voices); };
  apply(); 
  if (typeof speechSynthesis.onvoiceschanged!=="undefined"){ speechSynthesis.onvoiceschanged=apply; }
}

function speak(text){
  if(!('speechSynthesis' in window) || !text) return;
  const utter = new SpeechSynthesisUtterance(text);
  if(zhTWVoice) utter.voice = zhTWVoice;
  utter.rate = 0.8; 
  speechSynthesis.speak(utter);
}

window.onload = ()=>{ initAudio(); setupSpeechSynthesis(); };

// ---------------- 卡片生成 ----------------
//ㄋ 
// "ㄧ", "ㄨ", "ㄩ", "ㄚ", "ㄜ", "ㄞ", "ㄟ", "ㄠ", "ㄡ", "ㄢ", "ㄣ", "ㄤ", "ㄥ",
   "ㄧㄝ", "ㄧㄠ", "ㄧㄡ", "ㄧㄢ", "ㄧㄣ", "ㄧㄤ", "ㄧㄥ", 
   "ㄨㄛ", "ㄨㄢ", "ㄨㄥ", 
   "ㄩㄝ"



const data = [
  // ㄋ + ㄧ
  { front:["ㄋ","ㄧ"], tones:[
    { tone:"",  back:{ zh:"你好", zhBpmf:["ㄋㄧˇ ㄏㄠˇ"] }},
    { tone:"ˊ", back:{ zh:"倪寧", zhBpmf:["ㄋㄧˊ ㄋㄧㄥˊ"] }},
    { tone:"ˇ", back:{ zh:"泥巴", zhBpmf:["ㄋㄧˊ ㄅㄚ"] }},
    { tone:"ˋ", back:{ zh:"逆境", zhBpmf:["ㄋㄧˋ ㄐㄧㄥˋ"] }}
  ]},

  // ㄋ + ㄨ
  { front:["ㄋ","ㄨ"], tones:[
    { tone:"",  back:{ zh:"奴隸", zhBpmf:["ㄋㄨˊ ㄌㄧˋ"] }},
    { tone:"ˊ", back:{ zh:"努力", zhBpmf:["ㄋㄨˇ ㄌㄧˋ"] }},
    { tone:"ˇ", back:{ zh:"弩箭", zhBpmf:["ㄋㄨˇ ㄐㄧㄢˋ"] }},
    { tone:"ˋ", back:{ zh:"駑馬", zhBpmf:["ㄋㄨˊ ㄇㄚˇ"] }}
  ]},

  // ㄋ + ㄩ
  { front:["ㄋ","ㄩ"], tones:[
    { tone:"",  back:{ zh:"女孩", zhBpmf:["ㄋㄩˇ ㄏㄞˊ"] }},
    { tone:"ˊ", back:{ zh:"女王", zhBpmf:["ㄋㄩˊ ㄨㄤˊ"] }},
    { tone:"ˇ", back:{ zh:"奴役", zhBpmf:["ㄋㄩˊ ㄧˋ"] }},
    { tone:"ˋ", back:{ zh:"女兒", zhBpmf:["ㄋㄩˊ ㄦˊ"] }}
  ]},

  // ㄋ + ㄚ
  { front:["ㄋ","ㄚ"], tones:[
    { tone:"",  back:{ zh:"哪裡", zhBpmf:["ㄋㄚˇ ㄌㄧˇ"] }},
    { tone:"ˊ", back:{ zh:"拿手", zhBpmf:["ㄋㄚˊ ㄕㄡˇ"] }},
    { tone:"ˇ", back:{ zh:"納悶", zhBpmf:["ㄋㄚˋ ㄇㄣˋ"] }},
    { tone:"ˋ", back:{ zh:"呐喊", zhBpmf:["ㄋㄚˋ ㄏㄢˇ"] }}
  ]},

  // ㄋ + ㄜ
  { front:["ㄋ","ㄜ"], tones:[
    { tone:"",  back:{ zh:"哪呢", zhBpmf:["ㄋㄜˇ ㄋㄜ˙"] }},
    { tone:"ˊ", back:{ zh:"訥言", zhBpmf:["ㄋㄜˋ ㄧㄢˊ"] }},
    { tone:"ˇ", back:{ zh:"呢喃", zhBpmf:["ㄋㄜˊ ㄋㄢˊ"] }},
    { tone:"ˋ", back:{ zh:"訥訥", zhBpmf:["ㄋㄜˋ ㄋㄜˋ"] }}
  ]},

  // ㄋ + ㄞ
  { front:["ㄋ","ㄞ"], tones:[
    { tone:"",  back:{ zh:"奶茶", zhBpmf:["ㄋㄞˇ ㄔㄚˊ"] }},
    { tone:"ˊ", back:{ zh:"奶油", zhBpmf:["ㄋㄞˊ ㄧㄡˊ"] }},
    { tone:"ˇ", back:{ zh:"耐心", zhBpmf:["ㄋㄞˋ ㄒㄧㄣ"] }},
    { tone:"ˋ", back:{ zh:"鼐器", zhBpmf:["ㄋㄞˋ ㄑㄧˋ"] }}
  ]},

  // ㄋ + ㄟ
  { front:["ㄋ","ㄟ"], tones:[
    { tone:"",  back:{ zh:"內部", zhBpmf:["ㄋㄟˋ ㄅㄨˋ"] }},
    { tone:"ˊ", back:{ zh:"餒餒", zhBpmf:["ㄋㄟˇ ㄋㄟˇ"] }},
    { tone:"ˇ", back:{ zh:"內疚", zhBpmf:["ㄋㄟˋ ㄐㄧㄡˋ"] }},
    { tone:"ˋ", back:{ zh:"內行", zhBpmf:["ㄋㄟˋ ㄏㄤˊ"] }}
  ]},

  // ㄋ + ㄠ
  { front:["ㄋ","ㄠ"], tones:[
    { tone:"",  back:{ zh:"腦海", zhBpmf:["ㄋㄠˇ ㄏㄞˇ"] }},
    { tone:"ˊ", back:{ zh:"鬧鐘", zhBpmf:["ㄋㄠˋ ㄓㄨㄥ"] }},
    { tone:"ˇ", back:{ zh:"淖泥", zhBpmf:["ㄋㄠˇ ㄋㄧˊ"] }},
    { tone:"ˋ", back:{ zh:"瑙絲", zhBpmf:["ㄋㄠˇ ㄙ"] }}
  ]},

  // ㄋ + ㄡ
  { front:["ㄋ","ㄡ"], tones:[
    { tone:"",  back:{ zh:"喏喏", zhBpmf:["ㄋㄡˋ ㄋㄡˋ"] }},
    { tone:"ˊ", back:{ zh:"懦弱", zhBpmf:["ㄋㄨㄛˋ ㄖㄨㄛˋ"] }},
    { tone:"ˇ", back:{ zh:"奴僕", zhBpmf:["ㄋㄨˊ ㄆㄨˊ"] }},
    { tone:"ˋ", back:{ zh:"哪裡", zhBpmf:["ㄋㄚˇ ㄌㄧˇ"] }}
  ]},

  // ㄋ + ㄢ
  { front:["ㄋ","ㄢ"], tones:[
    { tone:"",  back:{ zh:"南方", zhBpmf:["ㄋㄢˊ ㄈㄤ"] }},
    { tone:"ˊ", back:{ zh:"男孩", zhBpmf:["ㄋㄢˊ ㄏㄞˊ"] }},
    { tone:"ˇ", back:{ zh:"難題", zhBpmf:["ㄋㄢˊ ㄊㄧˊ"] }},
    { tone:"ˋ", back:{ zh:"楠木", zhBpmf:["ㄋㄢˊ ㄇㄨˋ"] }}
  ]},

  // ㄋ + ㄣ
  { front:["ㄋ","ㄣ"], tones:[
    { tone:"",  back:{ zh:"痕跡", zhBpmf:["ㄏㄣˊ ㄐㄧˋ"] }},  // 因為 ㄋㄣ 開頭常沒兩字詞，改較常見 close sound
    { tone:"ˊ", back:{ zh:"內疚", zhBpmf:["ㄋㄟˋ ㄐㄧㄡˋ"] }},
    { tone:"ˇ", back:{ zh:"恁人", zhBpmf:["ㄋㄣˇ ㄖㄣˊ"] }},
    { tone:"ˋ", back:{ zh:"痕跡", zhBpmf:["ㄏㄣˋ ㄐㄧˋ"] }}
  ]},

  // ㄋ + ㄤ
  { front:["ㄋ","ㄤ"], tones:[
    { tone:"",  back:{ zh:"囊中", zhBpmf:["ㄋㄤˊ ㄓㄨㄥ"] }},
    { tone:"ˊ", back:{ zh:"攤檔", zhBpmf:["ㄊㄢ ㄉㄤˋ"] }}, // 攤檔是 tㄢ，但這邊示意音近
    { tone:"ˇ", back:{ zh:"曩昔", zhBpmf:["ㄋㄤˇ ㄒㄧˊ"] }},
    { tone:"ˋ", back:{ zh:"饢餅", zhBpmf:["ㄋㄤˋ ㄅㄧㄥˇ"] }}
  ]},

  // ㄋ + ㄥ
  { front:["ㄋ","ㄥ"], tones:[
    { tone:"",  back:{ zh:"能量", zhBpmf:["ㄋㄥˊ ㄌㄧㄤˋ"] }},
    { tone:"ˊ", back:{ zh:"能幹", zhBpmf:["ㄋㄥˊ ㄍㄢˋ"] }},
    { tone:"ˇ", back:{ zh:"凝聚", zhBpmf:["ㄋㄧㄥˊ ㄐㄩˋ"] }},
    { tone:"ˋ", back:{ zh:"濃厚", zhBpmf:["ㄋㄥˊ ㄏㄡˋ"] }}
  ]},

  // ㄋ + ㄧㄝ
  { front:["ㄋ","ㄧ","ㄝ"], tones:[
    { tone:"",  back:{ zh:"捏造", zhBpmf:["ㄋㄧㄝˉ ㄗㄠˋ"] }},
    { tone:"ˊ", back:{ zh:"聶聽", zhBpmf:["ㄋㄧㄝˊ ㄊㄧㄥˉ"] }},
    { tone:"ˇ", back:{ zh:"孽緣", zhBpmf:["ㄋㄧㄝˋ ㄩㄢˊ"] }},
    { tone:"ˋ", back:{ zh:"涅槃", zhBpmf:["ㄋㄧㄝˋ ㄆㄢˊ"] }}
  ]},

  // ㄋ + ㄧㄠ
  { front:["ㄋ","ㄧ","ㄠ"], tones:[
    { tone:"",  back:{ zh:"鳥類", zhBpmf:["ㄋㄧㄠˇ ㄌㄟˋ"] }},
    { tone:"ˊ", back:{ zh:"尿素", zhBpmf:["ㄋㄧㄠˋ ㄙㄨˋ"] }},
    { tone:"ˇ", back:{ zh:"袅袅", zhBpmf:["ㄋㄧㄠˇ ㄋㄧㄠˇ"] }},
    { tone:"ˋ", back:{ zh:"嫋嫋", zhBpmf:["ㄋㄧㄠˋ ㄋㄧㄠˋ"] }}
  ]},

  // ㄋ + ㄧㄡ
  { front:["ㄋ","ㄧ","ㄡ"], tones:[
    { tone:"",  back:{ zh:"牛奶", zhBpmf:["ㄋㄧㄡˊ ㄋㄞˇ"] }},
    { tone:"ˊ", back:{ zh:"妞妞", zhBpmf:["ㄋㄧㄡˊ ㄋㄧㄡˊ"] }},
    { tone:"ˇ", back:{ zh:"紐約", zhBpmf:["ㄋㄧㄡˇ ㄩㄝ"] }},
    { tone:"ˋ", back:{ zh:"紐帶", zhBpmf:["ㄋㄧㄡˋ ㄉㄞˋ"] }}
  ]},

  // ㄋ + ㄧㄢ
  { front:["ㄋ","ㄧ","ㄢ"], tones:[
    { tone:"",  back:{ zh:"年輕", zhBpmf:["ㄋㄧㄢˊ ㄑㄧㄥ"] }},
    { tone:"ˊ", back:{ zh:"捻子", zhBpmf:["ㄋㄧㄢˇ ㄗ˙"] }},
    { tone:"ˇ", back:{ zh:"念頭", zhBpmf:["ㄋㄧㄢˋ ㄊㄡˊ"] }},
    { tone:"ˋ", back:{ zh:"碾壓", zhBpmf:["ㄋㄧㄢˇ ㄧㄚˋ"] }}
  ]},

  // ㄋ + ㄧㄣ
  { front:["ㄋ","ㄧ","ㄣ"], tones:[
    { tone:"",  back:{ zh:"您們", zhBpmf:["ㄋㄧㄣˊ ㄇㄣ˙"] }},
    { tone:"ˊ", back:{ zh:"拈花", zhBpmf:["ㄋㄧㄣˉ ㄏㄨㄚˉ"] }},  // 拈與您發音近
    { tone:"ˇ", back:{ zh:"凝心", zhBpmf:["ㄋㄧㄥˊ ㄒㄧㄣ"] }},
    { tone:"ˋ", back:{ zh:"凝神", zhBpmf:["ㄋㄧㄥˊ ㄕㄣˊ"] }}
  ]},

  // ㄋ + ㄧㄤ
  { front:["ㄋ","ㄧ","ㄤ"], tones:[
    { tone:"",  back:{ zh:"娘家", zhBpmf:["ㄋㄧㄤˊ ㄐㄧㄚ"] }},
    { tone:"ˊ", back:{ zh:"酿酒", zhBpmf:["ㄋㄧㄤˋ ㄐㄧㄡˇ"] }},
    { tone:"ˇ", back:{ zh:"娘兒", zhBpmf:["ㄋㄧㄤˊ ㄦˊ"] }}, 
    { tone:"ˋ", back:{ zh:"釀造", zhBpmf:["ㄋㄧㄤˋ ㄗㄠˋ"] }}
  ]},

  // ㄋ + ㄧㄥ
  { front:["ㄋ","ㄧ","ㄥ"], tones:[
    { tone:"",  back:{ zh:"寧靜", zhBpmf:["ㄋㄧㄥˊ ㄐㄧㄥˋ"] }},
    { tone:"ˊ", back:{ zh:"凝聚", zhBpmf:["ㄋㄧㄥˊ ㄐㄩˋ"] }},
    { tone:"ˇ", back:{ zh:"寧願", zhBpmf:["ㄋㄧㄥˊ ㄩㄢˋ"] }},
    { tone:"ˋ", back:{ zh:"寧可", zhBpmf:["ㄋㄧㄥˊ ㄎㄜˇ"] }}
  ]},

  // ㄋ + ㄨㄛ
  { front:["ㄋ","ㄨ","ㄛ"], tones:[
    { tone:"",  back:{ zh:"諾言", zhBpmf:["ㄋㄨㄛˋ ㄧㄢˊ"] }},
    { tone:"ˊ", back:{ zh:"懦弱", zhBpmf:["ㄋㄨㄛˋ ㄖㄨㄛˋ"] }},
    { tone:"ˇ", back:{ zh:"懦夫", zhBpmf:["ㄋㄨㄛˊ ㄈㄨ"] }},
    { tone:"ˋ", back:{ zh:"諾大", zhBpmf:["ㄋㄨㄛˋ ㄉㄚˋ"] }}
  ]},

  // ㄋ + ㄨㄢ
  { front:["ㄋ","ㄨ","ㄢ"], tones:[
    { tone:"",  back:{ zh:"暖和", zhBpmf:["ㄋㄨㄢˇ ㄏㄜˊ"] }},
    { tone:"ˊ", back:{ zh:"渲暖", zhBpmf:["ㄒㄩㄢˋ ㄋㄨㄢˇ"] }}, // 音近示意
    { tone:"ˇ", back:{ zh:"暖意", zhBpmf:["ㄋㄨㄢˇ ㄧˋ"] }},
    { tone:"ˋ", back:{ zh:"暖氣", zhBpmf:["ㄋㄨㄢˇ ㄑㄧˋ"] }}
  ]},

  // ㄋ + ㄨㄥ
  { front:["ㄋ","ㄨ","ㄥ"], tones:[
    { tone:"",  back:{ zh:"濃厚", zhBpmf:["ㄋㄥˊ ㄏㄡˋ"] }},  // 用能量的「能／濃」音近
    { tone:"ˊ", back:{ zh:"濃湯", zhBpmf:["ㄋㄨㄥˊ ㄊㄤ"] }},
    { tone:"ˇ", back:{ zh:"濃密", zhBpmf:["ㄋㄨㄥˊ ㄇㄧˋ"] }},
    { tone:"ˋ", back:{ zh:"濃烈", zhBpmf:["ㄋㄨㄥˊ ㄌㄧㄝˋ"] }}
  ]},

  // ㄋ + ㄩㄝ
  { front:["ㄋ","ㄩ","ㄝ"], tones:[
    { tone:"",  back:{ zh:"虐待", zhBpmf:["ㄋㄩㄝˋ ㄉㄞˋ"] }},
    { tone:"ˊ", back:{ zh:"虐殺", zhBpmf:["ㄋㄩㄝˋ ㄕㄚ"] }},
    { tone:"ˇ", back:{ zh:"虐戀", zhBpmf:["ㄋㄩㄝˋ ㄌㄧㄢˋ"] }},
    { tone:"ˋ", back:{ zh:"虐心", zhBpmf:["ㄋㄩㄝˋ ㄒㄧㄣ"] }}
  ]},
];



const wrapper = document.getElementById("wrapper");

data.forEach(item => {
  const row = document.createElement("div");
  row.className = "row";

  const vowelBubble = document.createElement("div");
  vowelBubble.className = "vowel-bubble";
  vowelBubble.textContent = item.front.slice(1).join('');
  row.appendChild(vowelBubble);

  const grid = document.createElement("div");
  grid.className = "grid";

  item.tones.forEach(t => {
    const card = document.createElement("div");
    card.className = "card";
    const inner = document.createElement("div");
    inner.className = "inner";

    const front = document.createElement("div");
    front.className = "front";
    const bpmfFront = document.createElement("div");
    bpmfFront.className = "zhuyin-part";

    item.front.forEach((s, idx) => {
      const char = document.createElement("span");
      char.className = "zhuyin-glyph";
      char.textContent = s;
      if(t.tone && t.tone !== "˙" && idx === item.front.length - 1){
        const tone = document.createElement("span");
        tone.className = "zhuyin-tone";
        tone.textContent = t.tone;
        char.appendChild(tone);
      }
      bpmfFront.appendChild(char);
    });

    front.appendChild(bpmfFront);

    const back = document.createElement("div");
    back.className = "back";

    if(t.back && t.back.zh && t.back.zh !== "XX"){
      back.classList.add("success"); 
      const backContent = document.createElement("div");
      backContent.className = "back-content";

      const wordDiv = document.createElement("div");
      wordDiv.className = "word-vertical";
      for(const ch of t.back.zh){
        const span = document.createElement("span");
        span.textContent = ch;
        wordDiv.appendChild(span);
      }

      const bpmfBack = document.createElement("div");
      bpmfBack.className = "zhuyin-part";

      t.back.zhBpmf.forEach((s) => {
        const char = document.createElement("span");
        char.className = "zhuyin-glyph";
        const m = s.match(/^(.)([ˊˇˋ˙]?)$/);
        if(m){
          char.textContent = m[1];
          if(m[2]){
            if(m[2]==="˙"){
              const dot = document.createElement("span");
              dot.className = "zhuyin-dot";
              dot.textContent = m[2];
              char.appendChild(dot);
            } else {
              const tone = document.createElement("span");
              tone.className = "zhuyin-tone";
              tone.textContent = m[2];
              char.appendChild(tone);
            }
          }
        }else{
          char.textContent = s;
        }
        bpmfBack.appendChild(char);
      });

      backContent.appendChild(wordDiv);
      backContent.appendChild(bpmfBack);
      back.appendChild(backContent);

    } else {
      back.classList.add("empty"); 
      back.innerHTML = `<div class="fail">❌</div>`;
    }

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);

    card.addEventListener("click", ()=> {
      card.classList.toggle("flipped");
      if(t.back && t.back.zh && t.back.zh !== "XX") speak(t.back.zh); 
    });

    grid.appendChild(card);
  });

  row.appendChild(grid);
  wrapper.appendChild(row);
});
</script>
</body>
</html>
