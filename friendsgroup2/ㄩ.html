<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>拼音練習</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap">
<style>
body { font-family: "Noto Sans TC", sans-serif; background:#f0f0f0; text-align:center; padding:20px; }
h1 { margin-bottom:20px; }
.wrapper { display:flex; flex-direction:column; align-items:center; gap:20px; width:100%; max-width:900px; margin:0 auto; }
.row { display:flex; align-items:center; justify-content:center; gap:15px; width:100%; }
.vowel-bubble { background:#fff9c4; color:#333; font-weight:bold; border-radius:50%; width:3em; height:3em; display:flex; justify-content:center; align-items:center; border:2px solid #fbc02d; box-shadow:0 2px 5px rgba(0,0,0,0.15); flex-shrink:0; font-size:1.5em;}
.grid { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; flex:1; }
.card { width:100%; aspect-ratio:5/7; perspective:800px; position:relative; }
.inner { position:relative; width:100%; height:100%; text-align:center; transition:transform 0.8s; transform-style:preserve-3d; cursor:pointer; }
.card.flipped .inner { transform:rotateY(180deg); }
.front, .back { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:10px; display:flex; justify-content:center; align-items:center; }
.front { background:#fff; border:2px solid #bbb; font-weight:bold; }
.back { background:#fff; border:2px solid #888; transform:rotateY(180deg); flex-direction:column; justify-content:center; align-items:center; }
.back.success { background:#d4edda; border-color:#28a745; }
.back.empty { background:#ffe4e1; border-color:#ffb6c1; }
.fail { color:red; font-size:48px; }
.zhuyin-part { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:0.15em; line-height:1; font-family:"Noto Sans TC","PingFang TC","DFKai-SB",sans-serif; }
.zhuyin-glyph { position:relative; font-weight:normal; font-size:2em; text-align:center; }
.zhuyin-tone { position:absolute; font-size:1em; top:-0.4em; right:-0.6em; }
.zhuyin-dot { position:absolute; font-size:0.65em; top:1em; left:50%; transform:translateX(-50%); }
.word-vertical { display:flex; flex-direction:column; justify-content:center; align-items:center; line-height:1.15em; font-size:calc(4vw + 12px); }
.word-vertical span { display:block; }
.back-content { display:flex; flex-direction:row; justify-content:space-around; align-items:center; width:100%; }
.back-content .zhuyin-part { font-size:0.6em; }
</style>
</head>
<body>
<h1>ㄧ 拼音練習</h1>
<div class="wrapper" id="wrapper"></div>

<script>
// ---------------- 語音 ----------------
let audioCtx=null, zhTWVoice=null;
function initAudio(){ if(audioCtx) return; try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){console.error("Web Audio not supported");} }
function pickPreferredVoice(voices){
  const norm=s=>(s||'').toLowerCase().replace(/[\s_\-()（）:：,，.。]+/g,'');
  const isTW=v=>/^zh/i.test(v.lang||'') && /tw/i.test(v.lang||'');
  const isG=v=>/google/i.test(v.name||'');
  const isMS=v=>/microsoft/i.test(v.name||'');
  const N=voices.map(v=>({v,name:norm(v.name),uri:norm(v.voiceURI)}));
  let p=N.find(x=>isTW(x.v)&&isMS(x.v)&&(x.name.includes('yating')||x.uri.includes('yating'))); if(p) return p.v;
  p=N.find(x=>isTW(x.v)&&isMS(x.v)&&(x.name.includes('zhiwei')||x.uri.includes('zhiwei'))); if(p) return p.v;
  p=voices.find(v=>isTW(v)&&isG(v)&&/(國語|台灣|臺灣|mandarin|taiwan)/i.test(v.name||'')); if(p) return p;
  return (voices.find(v=>!isG(v)&&isTW(v))||voices.find(v=>isG(v)&&isTW(v))||voices.find(v=>isG(v)&&isCN(v))||voices.find(v=>!isG(v)&&isCN(v))||voices.find(isTW)||voices.find(isCN)||voices.find(isZH)||voices[0]||null);
}
function setupSpeechSynthesis(){ if(!('speechSynthesis' in window)) return; const apply=()=>{ const voices=speechSynthesis.getVoices()||[]; zhTWVoice=pickPreferredVoice(voices); }; apply(); if(typeof speechSynthesis.onvoiceschanged!=="undefined"){ speechSynthesis.onvoiceschanged=apply; } }
function speak(text){ if(!('speechSynthesis' in window)||!text)return; const utter=new SpeechSynthesisUtterance(text); if(zhTWVoice)utter.voice=zhTWVoice; utter.rate=0.8; speechSynthesis.speak(utter); }
window.onload=()=>{ initAudio(); setupSpeechSynthesis(); };

// ---------------- 卡片資料 ----------------
//ㄩ
// "ㄋ", "ㄌ", "ㄐ", "ㄑ", "ㄒ"


const initials = ["ㄋ", "ㄌ", "ㄐ", "ㄑ", "ㄒ"];
const medialY = "ㄩ";

const data = [
  { front:["ㄋ","ㄩ"], tones:[
    { tone:"", back:{ zh:"女兒", zhBpmf:["ㄋㄩˇ","ㄦˊ"] }},
    { tone:"ˊ", back:{ zh:"怒吼", zhBpmf:["ㄋㄩˋ","ㄏㄡˇ"] }},
    { tone:"ˇ", back:{ zh:"紐帶", zhBpmf:["ㄋㄧㄡˇ","ㄉㄞˋ"] }},
    { tone:"ˋ", back:{ zh:"乳液", zhBpmf:["ㄖㄨˇ","ㄧˋ"] }}
  ]},
  { front:["ㄌ","ㄩ"], tones:[
    { tone:"", back:{ zh:"旅館", zhBpmf:["ㄌㄩˇ","ㄍㄨㄢˇ"] }},
    { tone:"ˊ", back:{ zh:"履歷", zhBpmf:["ㄌㄩˇ","ㄌㄧˋ"] }},
    { tone:"ˇ", back:{ zh:"綠葉", zhBpmf:["ㄌㄩˋ","ㄧㄝˋ"] }},
    { tone:"ˋ", back:{ zh:"律師", zhBpmf:["ㄌㄩˋ","ㄕ"] }}
  ]},
  { front:["ㄐ","ㄩ"], tones:[
    { tone:"", back:{ zh:"巨人", zhBpmf:["ㄐㄩˋ","ㄖㄣˊ"] }},
    { tone:"ˊ", back:{ zh:"俱樂部", zhBpmf:["ㄐㄩˋ","ㄌㄜˋ","ㄅㄨˋ"] }},
    { tone:"ˇ", back:{ zh:"拘留", zhBpmf:["ㄐㄩ","ㄌㄧㄡˊ"] }},
    { tone:"ˋ", back:{ zh:"句子", zhBpmf:["ㄐㄩˋ","ㄗˇ"] }}
  ]},
  { front:["ㄑ","ㄩ"], tones:[
    { tone:"", back:{ zh:"去處", zhBpmf:["ㄑㄩˋ","ㄔㄨˋ"] }},
    { tone:"ˊ", back:{ zh:"曲線", zhBpmf:["ㄑㄩˇ","ㄒㄧㄢˋ"] }},
    { tone:"ˇ", back:{ zh:"取材", zhBpmf:["ㄑㄩˇ","ㄘㄞˊ"] }},
    { tone:"ˋ", back:{ zh:"區域", zhBpmf:["ㄑㄩ","ㄩˋ"] }}
  ]},
  { front:["ㄒ","ㄩ"], tones:[
    { tone:"", back:{ zh:"學生", zhBpmf:["ㄒㄩˊ","ㄕㄥˋ"] }},
    { tone:"ˊ", back:{ zh:"許願", zhBpmf:["ㄒㄩˇ","ㄩㄢˋ"] }},
    { tone:"ˇ", back:{ zh:"序列", zhBpmf:["ㄒㄩˋ","ㄌㄧㄝˋ"] }},
    { tone:"ˋ", back:{ zh:"絮語", zhBpmf:["ㄒㄩˋ","ㄩˇ"] }}
  ]}
];

// ---------------- 生成卡片 ----------------
const wrapper = document.getElementById("wrapper");

data.forEach(item=>{
  const row=document.createElement("div"); row.className="row";

  // 黃色圓圈顯示聲母
  const vowelBubble=document.createElement("div"); 
  vowelBubble.className="vowel-bubble";
  vowelBubble.textContent=item.front[0]; 
  row.appendChild(vowelBubble);

  const grid=document.createElement("div"); grid.className="grid";

  item.tones.forEach(t=>{
    const card=document.createElement("div"); card.className="card";
    const inner=document.createElement("div"); inner.className="inner";

    // 正面注音
    const front=document.createElement("div"); front.className="front";
    const bpmfFront=document.createElement("div"); bpmfFront.className="zhuyin-part";

    item.front.forEach((s,idx)=>{
      const char=document.createElement("span"); char.className="zhuyin-glyph"; 
      char.textContent=s;
      if(t.tone && t.tone!=="˙" && idx===item.front.length-1){
        const tone=document.createElement("span"); tone.className="zhuyin-tone"; tone.textContent=t.tone;
        char.appendChild(tone);
      }
      bpmfFront.appendChild(char);
    });
    front.appendChild(bpmfFront);

    // 背面
    const back=document.createElement("div"); back.className="back";
    if(t.back && t.back.zh && t.back.zh!=="XX"){
      back.classList.add("success");
      const backContent=document.createElement("div"); backContent.className="back-content";

      // 中文直式
      const wordDiv=document.createElement("div"); wordDiv.className="word-vertical";
      for(const ch of t.back.zh){ 
        const span=document.createElement("span"); span.textContent=ch; 
        wordDiv.appendChild(span); 
      }

      // 注音直式
      const bpmfBack=document.createElement("div"); bpmfBack.className="zhuyin-part";
      t.back.zhBpmf.forEach(s=>{
        const char=document.createElement("span"); char.className="zhuyin-glyph";
        const m=s.match(/^(.)([ˊˇˋ˙]?)$/);
        if(m){
          char.textContent=m[1];
          if(m[2]){
            if(m[2]==="˙"){
              const dot=document.createElement("span"); dot.className="zhuyin-dot"; dot.textContent=m[2]; 
              char.appendChild(dot); 
            } else {
              const tone=document.createElement("span"); tone.className="zhuyin-tone"; tone.textContent=m[2]; 
              char.appendChild(tone); 
            }
          }
        } else { char.textContent=s; }
        bpmfBack.appendChild(char);
      });

      backContent.appendChild(wordDiv); 
      backContent.appendChild(bpmfBack); 
      back.appendChild(backContent);

    } else {
      back.classList.add("empty"); 
      back.innerHTML=`<div class="fail">❌</div>`;
    }

    inner.appendChild(front); inner.appendChild(back); card.appendChild(inner);
    card.addEventListener("click",()=>{
      card.classList.toggle("flipped"); 
      if(t.back && t.back.zh && t.back.zh!=="XX") speak(t.back.zh); 
    });
    grid.appendChild(card);
  });

  row.appendChild(grid);
  wrapper.appendChild(row);
});
</script>
</body>
</html>
